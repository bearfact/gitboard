(function(){var CSRFToken,Click,ComponentUrl,Link,browserCompatibleDocumentParser,browserIsntBuggy,browserSupportsCustomEvents,browserSupportsPushState,browserSupportsTurbolinks,bypassOnLoadPopstate,cacheCurrentPage,cacheSize,changePage,constrainPageCacheTo,createDocument,currentState,enableTransitionCache,executeScriptTags,extractTitleAndBody,fetch,fetchHistory,fetchReplacement,historyStateIsDefined,initializeTurbolinks,installDocumentReadyPageEventTriggers,installHistoryChangeHandler,installJqueryAjaxSuccessPageUpdateTrigger,loadedAssets,pageCache,pageChangePrevented,pagesCached,popCookie,processResponse,recallScrollPosition,referer,reflectNewUrl,reflectRedirectedUrl,rememberCurrentState,rememberCurrentUrl,rememberReferer,removeNoscriptTags,requestMethodIsSafe,resetScrollPosition,transitionCacheEnabled,transitionCacheFor,triggerEvent,visit,xhr,_ref,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice;pageCache={},cacheSize=10,transitionCacheEnabled=!1,currentState=null,loadedAssets=null,referer=null,createDocument=null,xhr=null,fetch=function(url){var cachedPage;return url=new ComponentUrl(url),rememberReferer(),cacheCurrentPage(),reflectNewUrl(url),transitionCacheEnabled&&(cachedPage=transitionCacheFor(url.absolute))?(fetchHistory(cachedPage),fetchReplacement(url)):fetchReplacement(url,resetScrollPosition)},transitionCacheFor=function(url){var cachedPage;return cachedPage=pageCache[url],cachedPage&&!cachedPage.transitionCacheDisabled?cachedPage:void 0},enableTransitionCache=function(enable){return null==enable&&(enable=!0),transitionCacheEnabled=enable},fetchReplacement=function(url,onLoadFunction){return null==onLoadFunction&&(onLoadFunction=function(){return function(){}}(this)),triggerEvent("page:fetch",{url:url.absolute}),null!=xhr&&xhr.abort(),xhr=new XMLHttpRequest,xhr.open("GET",url.withoutHashForIE10compatibility(),!0),xhr.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),xhr.setRequestHeader("X-XHR-Referer",referer),xhr.onload=function(){var doc;return triggerEvent("page:receive"),(doc=processResponse())?(changePage.apply(null,extractTitleAndBody(doc)),reflectRedirectedUrl(),onLoadFunction(),triggerEvent("page:load")):document.location.href=url.absolute},xhr.onloadend=function(){return xhr=null},xhr.onerror=function(){return document.location.href=url.absolute},xhr.send()},fetchHistory=function(cachedPage){return null!=xhr&&xhr.abort(),changePage(cachedPage.title,cachedPage.body),recallScrollPosition(cachedPage),triggerEvent("page:restore")},cacheCurrentPage=function(){var currentStateUrl;return currentStateUrl=new ComponentUrl(currentState.url),pageCache[currentStateUrl.absolute]={url:currentStateUrl.relative,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime(),transitionCacheDisabled:null!=document.querySelector("[data-no-transition-cache]")},constrainPageCacheTo(cacheSize)},pagesCached=function(size){return null==size&&(size=cacheSize),/^[\d]+$/.test(size)?cacheSize=parseInt(size):void 0},constrainPageCacheTo=function(limit){var cacheTimesRecentFirst,key,pageCacheKeys,_i,_len,_results;for(pageCacheKeys=Object.keys(pageCache),cacheTimesRecentFirst=pageCacheKeys.map(function(url){return pageCache[url].cachedAt}).sort(function(a,b){return b-a}),_results=[],_i=0,_len=pageCacheKeys.length;_len>_i;_i++)key=pageCacheKeys[_i],pageCache[key].cachedAt<=cacheTimesRecentFirst[limit]&&(triggerEvent("page:expire",pageCache[key]),_results.push(delete pageCache[key]));return _results},changePage=function(title,body,csrfToken,runScripts){return document.title=title,document.documentElement.replaceChild(body,document.body),null!=csrfToken&&CSRFToken.update(csrfToken),runScripts&&executeScriptTags(),currentState=window.history.state,triggerEvent("page:change"),triggerEvent("page:update")},executeScriptTags=function(){var attr,copy,nextSibling,parentNode,script,scripts,_i,_j,_len,_len1,_ref,_ref1;for(scripts=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')),_i=0,_len=scripts.length;_len>_i;_i++)if(script=scripts[_i],""===(_ref=script.type)||"text/javascript"===_ref){for(copy=document.createElement("script"),_ref1=script.attributes,_j=0,_len1=_ref1.length;_len1>_j;_j++)attr=_ref1[_j],copy.setAttribute(attr.name,attr.value);copy.appendChild(document.createTextNode(script.innerHTML)),parentNode=script.parentNode,nextSibling=script.nextSibling,parentNode.removeChild(script),parentNode.insertBefore(copy,nextSibling)}},removeNoscriptTags=function(node){return node.innerHTML=node.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi,""),node},reflectNewUrl=function(url){return(url=new ComponentUrl(url)).absolute!==referer?window.history.pushState({turbolinks:!0,url:url.absolute},"",url.absolute):void 0},reflectRedirectedUrl=function(){var location,preservedHash;return(location=xhr.getResponseHeader("X-XHR-Redirected-To"))?(location=new ComponentUrl(location),preservedHash=location.hasNoHash()?document.location.hash:"",window.history.replaceState(currentState,"",location.href+preservedHash)):void 0},rememberReferer=function(){return referer=document.location.href},rememberCurrentUrl=function(){return window.history.replaceState({turbolinks:!0,url:document.location.href},"",document.location.href)},rememberCurrentState=function(){return currentState=window.history.state},recallScrollPosition=function(page){return window.scrollTo(page.positionX,page.positionY)},resetScrollPosition=function(){return document.location.hash?document.location.href=document.location.href:window.scrollTo(0,0)},popCookie=function(name){var value,_ref;return value=(null!=(_ref=document.cookie.match(new RegExp(name+"=(\\w+)")))?_ref[1].toUpperCase():void 0)||"",document.cookie=name+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/",value},triggerEvent=function(name,data){var event;return event=document.createEvent("Events"),data&&(event.data=data),event.initEvent(name,!0,!0),document.dispatchEvent(event)},pageChangePrevented=function(){return!triggerEvent("page:before-change")},processResponse=function(){var assetsChanged,clientOrServerError,doc,extractTrackAssets,intersection,validContent;return clientOrServerError=function(){var _ref;return 400<=(_ref=xhr.status)&&600>_ref},validContent=function(){return xhr.getResponseHeader("Content-Type").match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)},extractTrackAssets=function(doc){var node,_i,_len,_ref,_results;for(_ref=doc.head.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)node=_ref[_i],null!=("function"==typeof node.getAttribute?node.getAttribute("data-turbolinks-track"):void 0)&&_results.push(node.getAttribute("src")||node.getAttribute("href"));return _results},assetsChanged=function(doc){var fetchedAssets;return loadedAssets||(loadedAssets=extractTrackAssets(document)),fetchedAssets=extractTrackAssets(doc),fetchedAssets.length!==loadedAssets.length||intersection(fetchedAssets,loadedAssets).length!==loadedAssets.length},intersection=function(a,b){var value,_i,_len,_ref,_results;for(a.length>b.length&&(_ref=[b,a],a=_ref[0],b=_ref[1]),_results=[],_i=0,_len=a.length;_len>_i;_i++)value=a[_i],__indexOf.call(b,value)>=0&&_results.push(value);return _results},!clientOrServerError()&&validContent()&&(doc=createDocument(xhr.responseText),doc&&!assetsChanged(doc))?doc:void 0},extractTitleAndBody=function(doc){var title;return title=doc.querySelector("title"),[null!=title?title.textContent:void 0,removeNoscriptTags(doc.body),CSRFToken.get(doc).token,"runScripts"]},CSRFToken={get:function(doc){var tag;return null==doc&&(doc=document),{node:tag=doc.querySelector('meta[name="csrf-token"]'),token:null!=tag&&"function"==typeof tag.getAttribute?tag.getAttribute("content"):void 0}},update:function(latest){var current;return current=this.get(),null!=current.token&&null!=latest&&current.token!==latest?current.node.setAttribute("content",latest):void 0}},browserCompatibleDocumentParser=function(){var createDocumentUsingDOM,createDocumentUsingParser,createDocumentUsingWrite,e,testDoc,_ref;createDocumentUsingParser=function(html){return(new DOMParser).parseFromString(html,"text/html")},createDocumentUsingDOM=function(html){var doc;return doc=document.implementation.createHTMLDocument(""),doc.documentElement.innerHTML=html,doc},createDocumentUsingWrite=function(html){var doc;return doc=document.implementation.createHTMLDocument(""),doc.open("replace"),doc.write(html),doc.close(),doc};try{if(window.DOMParser)return testDoc=createDocumentUsingParser("<html><body><p>test"),createDocumentUsingParser}catch(_error){return e=_error,testDoc=createDocumentUsingDOM("<html><body><p>test"),createDocumentUsingDOM}finally{if(1!==(null!=testDoc&&null!=(_ref=testDoc.body)?_ref.childNodes.length:void 0))return createDocumentUsingWrite}},ComponentUrl=function(){function ComponentUrl(original){return this.original=null!=original?original:document.location.href,this.original.constructor===ComponentUrl?this.original:void this._parse()}return ComponentUrl.prototype.withoutHash=function(){return this.href.replace(this.hash,"")},ComponentUrl.prototype.withoutHashForIE10compatibility=function(){return this.withoutHash()},ComponentUrl.prototype.hasNoHash=function(){return 0===this.hash.length},ComponentUrl.prototype._parse=function(){var _ref;return(null!=this.link?this.link:this.link=document.createElement("a")).href=this.original,_ref=this.link,this.href=_ref.href,this.protocol=_ref.protocol,this.host=_ref.host,this.hostname=_ref.hostname,this.port=_ref.port,this.pathname=_ref.pathname,this.search=_ref.search,this.hash=_ref.hash,this.origin=[this.protocol,"//",this.hostname].join(""),0!==this.port.length&&(this.origin+=":"+this.port),this.relative=[this.pathname,this.search,this.hash].join(""),this.absolute=this.href},ComponentUrl}(),Link=function(_super){function Link(link){return this.link=link,this.link.constructor===Link?this.link:(this.original=this.link.href,void Link.__super__.constructor.apply(this,arguments))}return __extends(Link,_super),Link.HTML_EXTENSIONS=["html"],Link.allowExtensions=function(){var extension,extensions,_i,_len;for(extensions=1<=arguments.length?__slice.call(arguments,0):[],_i=0,_len=extensions.length;_len>_i;_i++)extension=extensions[_i],Link.HTML_EXTENSIONS.push(extension);return Link.HTML_EXTENSIONS},Link.prototype.shouldIgnore=function(){return this._crossOrigin()||this._anchored()||this._nonHtml()||this._optOut()||this._target()},Link.prototype._crossOrigin=function(){return this.origin!==(new ComponentUrl).origin},Link.prototype._anchored=function(){var current;return(this.hash&&this.withoutHash())===(current=new ComponentUrl).withoutHash()||this.href===current.href+"#"},Link.prototype._nonHtml=function(){return this.pathname.match(/\.[a-z]+$/g)&&!this.pathname.match(new RegExp("\\.(?:"+Link.HTML_EXTENSIONS.join("|")+")?$","g"))},Link.prototype._optOut=function(){var ignore,link;for(link=this.link;!ignore&&link!==document;)ignore=null!=link.getAttribute("data-no-turbolink"),link=link.parentNode;return ignore},Link.prototype._target=function(){return 0!==this.link.target.length},Link}(ComponentUrl),Click=function(){function Click(event){this.event=event,this.event.defaultPrevented||(this._extractLink(),this._validForTurbolinks()&&(pageChangePrevented()||visit(this.link.href),this.event.preventDefault()))}return Click.installHandlerLast=function(event){return event.defaultPrevented?void 0:(document.removeEventListener("click",Click.handle,!1),document.addEventListener("click",Click.handle,!1))},Click.handle=function(event){return new Click(event)},Click.prototype._extractLink=function(){var link;for(link=this.event.target;link.parentNode&&"A"!==link.nodeName;)link=link.parentNode;return"A"===link.nodeName&&0!==link.href.length?this.link=new Link(link):void 0},Click.prototype._validForTurbolinks=function(){return null!=this.link&&!(this.link.shouldIgnore()||this._nonStandardClick())},Click.prototype._nonStandardClick=function(){return this.event.which>1||this.event.metaKey||this.event.ctrlKey||this.event.shiftKey||this.event.altKey},Click}(),bypassOnLoadPopstate=function(fn){return setTimeout(fn,500)},installDocumentReadyPageEventTriggers=function(){return document.addEventListener("DOMContentLoaded",function(){return triggerEvent("page:change"),triggerEvent("page:update")},!0)},installJqueryAjaxSuccessPageUpdateTrigger=function(){return"undefined"!=typeof jQuery?jQuery(document).on("ajaxSuccess",function(event,xhr){return jQuery.trim(xhr.responseText)?triggerEvent("page:update"):void 0}):void 0},installHistoryChangeHandler=function(event){var cachedPage,_ref;return(null!=(_ref=event.state)?_ref.turbolinks:void 0)?(cachedPage=pageCache[new ComponentUrl(event.state.url).absolute])?(cacheCurrentPage(),fetchHistory(cachedPage)):visit(event.target.location.href):void 0},initializeTurbolinks=function(){return rememberCurrentUrl(),rememberCurrentState(),createDocument=browserCompatibleDocumentParser(),document.addEventListener("click",Click.installHandlerLast,!0),bypassOnLoadPopstate(function(){return window.addEventListener("popstate",installHistoryChangeHandler,!1)})},historyStateIsDefined=void 0!==window.history.state||navigator.userAgent.match(/Firefox\/2[6|7]/),browserSupportsPushState=window.history&&window.history.pushState&&window.history.replaceState&&historyStateIsDefined,browserIsntBuggy=!navigator.userAgent.match(/CriOS\//),requestMethodIsSafe="GET"===(_ref=popCookie("request_method"))||""===_ref,browserSupportsTurbolinks=browserSupportsPushState&&browserIsntBuggy&&requestMethodIsSafe,browserSupportsCustomEvents=document.addEventListener&&document.createEvent,browserSupportsCustomEvents&&(installDocumentReadyPageEventTriggers(),installJqueryAjaxSuccessPageUpdateTrigger()),browserSupportsTurbolinks?(visit=fetch,initializeTurbolinks()):visit=function(url){return document.location.href=url},this.Turbolinks={visit:visit,pagesCached:pagesCached,enableTransitionCache:enableTransitionCache,allowLinkExtensions:Link.allowExtensions,supported:browserSupportsTurbolinks}}).call(this);var gitBoard=angular.module("gitBoard",["ngAnimate","ngRoute","restangular","ui.bootstrap","ui.sortable"]);angular.element(document).ready(function(){return jQuery.ajax({url:"/app_bootstrap",contentType:"application/json",dataType:"json",success:function(result){angular.bootstrap(document,["gitBoard"]);var ss=angular.element(document).injector().get("stateService");ss.setCurrentUser(result.current_user),ss.setIssuesStatuses(result.statuses)},async:!1})}),gitBoard.config(["$routeProvider",function($routeProvider){return $routeProvider.when("/",{templateUrl:"partials/repositories.html",controller:"gbRepositoriesCtrl"}),$routeProvider.when("/repositories",{templateUrl:"partials/repositories.html",controller:"gbRepositoriesCtrl"}),$routeProvider.when("/owners/:owner_id/repositories/:repository_id/issues_board",{templateUrl:"partials/issues_board.html",controller:"gbIssuesBoardCtrl"}),$routeProvider.when("/owners/:owner_id/repositories/:repository_id/milestones",{templateUrl:"partials/milestones.html",controller:"gbMilestonesCtrl"}),$routeProvider.when("/profile",{templateUrl:"partials/user_profile.html",controller:"gbUserProfileCtrl"}),$routeProvider.when("/pagenotfound",{templateUrl:"partials/page_not_found.html"}),$routeProvider.otherwise({redirectTo:"/pagenotfound"})}]),gitBoard.config(function($httpProvider){return $httpProvider.interceptors.push("myHttpInterceptor")}),gitBoard.config(["$httpProvider",function(provider){provider.defaults.headers.common["X-CSRF-Token"]=$("meta[name=csrf-token]").attr("content")}]),gitBoard.config(function(RestangularProvider){return RestangularProvider.setRequestSuffix(".json")}),toastr.options={debug:!1,positionClass:"toast-top-left"},gitBoard.value("toastr",toastr),gitBoard.value("undy",_),gitBoard.controller("gbEditRepoCtrl",function($scope,$modalInstance,editable_repo,undy){$scope.repo=editable_repo,$scope.ok=function(){return $modalInstance.close($scope.repo)},$scope.cancel=function(){return $modalInstance.dismiss("cancel")},$scope.add_new_column=function(){$scope.repo.issues_statuses.push({name:"A new guy",label:"status:new_label",position:_.last($scope.repo.issues_statuses).position+1})},$scope.remove_column=function(status){if(status._destroy=!0,!status.id){var index=-1;_.each($scope.repo.issues_statuses,function(obj,idx){return obj.position==status.position?(index=idx,!1):void 0}),index>-1&&$scope.repo.issues_statuses.splice(index,1)}},$scope.undo_column=function(status){status._destroy=!1};var tmpList=$scope.repo.issues_statuses;$scope.list=tmpList,$scope.sortableOptions={stop:function(){undy.each($scope.repo.issues_statuses,function(status,index){status.position=index+1})}}}),gitBoard.controller("gbIssuesBoardCtrl",gbIssuesBoardCtrl=function($scope,$routeParams,stateService,Restangular,undy,$timeout,toastHelper,issuesStatusService,milestoneHelper,$q){function load(data){$scope.all_milestones=data[0],$scope.priorities=data[1],$scope.assignable_users=data[2],$scope.current_repository=data[3],$scope.issues=data[4],$scope.milestones=undy.uniq(undy.pluck(undy.pluck($scope.issues,"milestone"),"title")),$scope.users=[];var user_names=[];undy.each($scope.issues,function(issue){undy.contains(user_names,issue.assignee.login)||(user_names.push(issue.assignee.login),$scope.users.push(issue.assignee))}),$scope.current_user.issues_board_settings&&($scope.query=$scope.current_user.issues_board_settings,undy.contains($scope.milestones,$scope.query.milestone)||($scope.query.milestone=""),undy.contains(user_names,$scope.query.login)||($scope.query.login="")),$scope.my_issues_count=undy.reduce($scope.issues,function(memo,res){return res.assignee.login==$scope.current_user.login?memo+=1:memo},0),$scope.unassigned_issues_count=undy.reduce($scope.issues,function(memo,res){return"Unassigned"==res.assignee.login?memo+=1:memo},0)}$scope.loading=!0,stateService.setCurrentRepository($routeParams.repository_id),stateService.setCurrentOwner($routeParams.owner_id),$scope.current_user=stateService.getCurrentUser(),$scope.milestoneHelper=milestoneHelper;var restangular_user=null;$scope.query={login:"",milestone:"",order:"number"},$scope.issues=[];var dispatcher=new WebSocketRails(window.location.host+"/websocket");dispatcher.on_open=function(data){console.log("Connection has been established: ",data)};var channel=dispatcher.subscribe_private(stateService.getCurrentOwner()+":"+stateService.getCurrentRepository()+":issues");channel.bind("updated",function(data){issue=undy.findWhere($scope.issues,{id:data.id}),$scope.$apply(function(){angular.extend(issue,data)}),toastHelper.showSuccess("Issue "+issue.number+" has been updated")}),channel.bind("opened",function(data){$scope.$apply(function(){$scope.issues.push(data)}),toastHelper.showSuccess("Issue #"+data.number+" opened")}),channel.bind("closed",function(data){var index=-1;_.each($scope.issues,function(obj,idx){return obj.id==data.id?(index=idx,!1):void 0}),index>-1&&$scope.$apply(function(){$scope.issues.splice(index,1)}),toastHelper.showSuccess("Issue #"+data.number+" closed")}),$scope.$on("$destroy",function(){channel.destroy(),dispatcher.disconnect()}),$scope.$on("issueDropEvent",function(event,issue){var events,old_status,status;issue.new_position!==issue.status.position&&(old_status=issue.status.label,status=issuesStatusService.getStatusByPosition(issue.new_position,$scope.current_repository.issues_statuses),issue.status=status,events=Restangular.all("change_issues_status_events"),events.post({issue_id:issue.id,status:issue.status.label,old_status:old_status,issue_number:issue.number,owner:stateService.getCurrentOwner(),repo:stateService.getCurrentRepository()}).then(function(data){angular.extend(issue,data.issue)},errorCallback=function(){toastHelper.showError("Could not complete the request")}))}),$scope.set_assignee=function(login){$scope.query.login=login},$scope.change_milestone=function(issue,milestone){if(issue.milestone.number!=milestone.number){var errorCallback,events;events=Restangular.all("change_issues_milestone_events"),events.post({issue_number:issue.number,owner:stateService.getCurrentOwner(),repo:stateService.getCurrentRepository(),milestone_number:milestone.number}).then(function(){toastHelper.showSuccess("Milestone has been updated"),issue.milestone=milestone},errorCallback=function(){toastHelper.showError("Could not complete the request")})}},$scope.change_priority=function(issue,priority){var events,old_priority,priority;issue.priority!==priority.id&&(old_priority=issue.priority,priority=priority.id,events=Restangular.all("change_issues_priority_events"),events.post({issue_id:issue.id,priority:priority,old_priority:old_priority,issue_number:issue.number,owner:stateService.getCurrentOwner(),repo:stateService.getCurrentRepository()}).then(function(data){angular.extend(issue,data.issue),toastHelper.showSuccess("Priority has been updated")},errorCallback=function(){toastHelper.showSuccess("Could not complete the request")}))},$scope.assign_user=function(issue,user){if(issue.assignee.login!=user.login){var errorCallback,events;return events=Restangular.all("assign_issue_events"),events.post({issue_number:issue.number,owner:stateService.getCurrentOwner(),repo:stateService.getCurrentRepository(),user_login:user.login}).then(function(){issue.assignee=user,toastHelper.showSuccess("Unassigned"!=user.login?"You have assigned the issue":"You have unassigned the issue")},errorCallback=function(){return toastHelper.showError("Could not complete the request")})}},$scope.calc_milestone_percent=function(milestone){return milestone.closed_issues/(milestone.closed_issues+milestone.open_issues)*100},$scope.$watch("query",function(values){null==restangular_user?Restangular.one("users",$scope.current_user.id).get().then(function(user){restangular_user=user}):(restangular_user.issues_board_settings=values,restangular_user.put())},!0);var promises=[];promises.push(Restangular.all("milestones").getList({repo:stateService.getCurrentRepository(),owner:stateService.getCurrentOwner()})),promises.push(Restangular.all("issues_priorities").getList()),promises.push(Restangular.one("owners",stateService.getCurrentOwner()).all("users").getList()),promises.push(Restangular.one("owners",stateService.getCurrentOwner()).one("repositories",stateService.getCurrentRepository()).get()),promises.push(Restangular.one("owners",stateService.getCurrentOwner()).one("repositories",stateService.getCurrentRepository()).all("issues").getList()),$q.all(promises).then(function(data){load(data),$scope.loading=!1},function(){})}),gitBoard.controller("gbMilestonesCtrl",function($scope,Restangular,stateService,milestoneHelper,$routeParams){stateService.setFromRoute($routeParams),$scope.stateService=stateService,$scope.milestoneHelper=milestoneHelper,$scope.calc_milestone_percent=function(milestone){return milestone.closed_issues/(milestone.closed_issues+milestone.open_issues)*100},$scope.github_url=function(){return"https://github.com/"+stateService.getCurrentOwner()+"/"+stateService.getCurrentRepository()+"/issues/milestones"},$scope.milestones=Restangular.all("milestones").getList({repo:stateService.getCurrentRepository(),owner:stateService.getCurrentOwner()}).$object,$scope.progress_bar_type=function(milestone){var a=moment(milestone.due_on),b=moment(milestone.created_at),c=moment(),totalDays=a.diff(b,"days"),daysLeft=a.diff(c,"days"),durationPercent=(totalDays-daysLeft)/totalDays,completedPercent=milestone.closed_issues/(milestone.closed_issues+milestone.open_issues);return moment().isAfter(milestone.due_on)?"danger":durationPercent>completedPercent?"warning":"success"}}),gitBoard.controller("gbNewRepoCtrl",function($scope,toastHelper,Restangular){return $scope.repo={},$scope.repos=[],$scope.submit=function(repo){var baseRepos,errorCallback,payload;return baseRepos=Restangular.all("repositories"),payload={owner:repo.owner,name:repo.name.name,url:repo.url,description:repo.description},baseRepos.post(payload).then(function(){return toastHelper.showSuccess("Your repo has been added"),$scope.$emit("repoAddedEvent",null)},errorCallback=function(err){return toastHelper.showErrorsFromValidation(err.data)})},$scope.owners=Restangular.all("github_owners").getList().$object,$scope.$watch("repo.owner",function(selected_owner){return selected_owner?$scope.repos=Restangular.one("github_owners",selected_owner).all("github_repositories").getList().$object:void 0}),$scope.$watch("repo.name",function(selected_repo){return selected_repo?($scope.repo.url=selected_repo.html_url,$scope.repo.description=selected_repo.description):void 0})}),gitBoard.controller("gbRepositoriesCtrl",function($scope,$modal,Restangular,toastHelper,undy,stateService){stateService.setFromRoute({}),stateService.setActivePage("repos"),$scope.delete_repo=function(repo){repo.remove().then(function(){$scope.repositories=undy.without($scope.repositories,repo),toastHelper.showSuccess("Repository deleted")})},$scope.open_edit_modal=function(repo){var editable_repo,modal_instance;editable_repo=angular.copy(repo),modal_instance=$modal.open({templateUrl:"/partials/gb_repo_form.html",controller:"gbEditRepoCtrl",resolve:{editable_repo:function(){return editable_repo}}}),modal_instance.result.then(function(edited_repo){angular.copy(edited_repo,repo),Restangular.one("repositories",repo.id).get({single:!0}).then(function(repository){repository=Restangular.copy(repo),repository.issues_statuses_attributes=repository.issues_statuses,repository.put().then(function(){toastHelper.showSuccess("Repository has been updated")})})},function(){})},$scope.$on("repoAddedEvent",function(){fetchRepos()});var fetchRepos=function(){Restangular.all("repositories").getList().then(function(res){$scope.repositories=res})};fetchRepos()}),gitBoard.controller("gbTopNavCtrl",function($scope,$location,stateService,$window){$scope.user={login:""},$scope.authcode=200,$scope.titleNav="/",$scope.repo_selected=!1,$scope.repo_url="",$scope.$watch(function(){return stateService.getCurrentRepository()},function(data){data?($scope.repo_selected=!0,$scope.repo_url=stateService.repositoryUrl()):($scope.repo_selected=!1,$scope.repo_url="")},!0),$scope.getCurrentUser=function(){return stateService.getCurrentUser()?($scope.logged_in=!0,$scope.user=stateService.getCurrentUser(),$scope.titleNav="#/repositories"):void 0},$scope.signout=function(){return $window.location.href="/sign_out"},$scope.getCurrentUser()}),gitBoard.controller("gbUserProfileCtrl",gbUserProfileCtrl=function(){}),gitBoard.directive("appVersion",["version",function(version){return function(scope,elm){return elm.text(version)}}]),gitBoard.directive("gbTopNav",function(){return{restrict:"E",templateUrl:"/partials/templates/gb_top_nav.html",controller:"gbTopNavCtrl"}}),gitBoard.directive("gbIssueCard",function(){return{restrict:"E",templateUrl:"/partials/templates/gb_issue_card.html",replace:!0,link:function(scope,element){return element.find(".issue-text-popover").popover()}}}),gitBoard.directive("gbNoSwearing",function(){return function(scope,element,attrs){var badWords,inputValue;return badWords=["shit","fuck","cock"],inputValue="",scope.$watch(attrs.ngModel,function(v){return inputValue=v}),element.bind("blur",function(){var found;return found=!1,_.each(badWords,function(word){return-1!==inputValue.indexOf(word)?found=!0:void 0}),found?element.addClass("error"):element.removeClass("error")})}}),gitBoard.directive("fitToParent",["$timeout",function(timer){return{link:function(scope,elem){var fitToParent=function(){var p_height=elem.parent().height();elem.height(p_height)};timer(fitToParent,0)}}}]),gitBoard.directive("draggable",function(){return function(scope,element){var el;return el=element[0],el.draggable=!0,el.addEventListener("dragstart",function(e){return e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("Text",this.id),this.classList.add("drag"),!1},!1),el.addEventListener("dragend",function(){return this.classList.remove("drag"),!1},!1)}}),gitBoard.directive("droppable",function(){return{scope:{drop:"&drop"},link:function(scope,element){var el;return el=element[0],el.addEventListener("dragover",function(e){return e.dataTransfer.dropEffect="move",e.preventDefault&&e.preventDefault(),this.classList.add("over"),!1},!1),el.addEventListener("dragenter",function(){return this.classList.add("over"),!1},!1),el.addEventListener("dragleave",function(){return this.classList.remove("over"),!1},!1),el.addEventListener("drop",function(e){var data,item;return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),this.classList.remove("over"),item=document.getElementById(e.dataTransfer.getData("Text")),data=$(item).data().$scope.issue,data.new_position=scope.drop(),scope.$emit("issueDropEvent",data),!1},!1)}}}),gitBoard.filter("interpolate",["version",function(version){return function(text){return String(text).replace(/\%VERSION\%/gm,version)}}]),gitBoard.filter("markdown",function($sce){var converter=new Showdown.converter;return function(value){var html=converter.makeHtml(value||"");return $sce.trustAsHtml(html)}}),gitBoard.filter("status",function(){return function(items,status){var filtered=[];return angular.forEach(items,function(item){status==item.status.position&&filtered.push(item)}),filtered}}),gitBoard.filter("milestone",function(){return function(items,milestone){var filtered=[];return milestone&&""!=milestone?(angular.forEach(items,function(item){milestone==item.milestone.title&&filtered.push(item)}),filtered):items}}),gitBoard.filter("assignee",function(){return function(items,login){var filtered=[];return login&&""!=login?(angular.forEach(items,function(item){login==item.assignee.login&&filtered.push(item)}),filtered):items}}),gitBoard.value("version","0.1").factory("myHttpInterceptor",function($q,$location,toastHelper){return{response:function(response){var data;return"application/json; charset=utf-8"!==response.headers()["content-type"]||(data=!0)?response:$q.reject(response)},responseError:function(response){return 403===response.status&&(response.headers()["content-type"].indexOf("application/json")>-1?toastHelper.showError("Your session has expired.  Please log in again."):window.location="/"),$q.reject(response)}}}).service("issuesStatusService",function(){return{getStatusByPosition:function(position,statuses){return _.findWhere(statuses,{position:position})},getStatusById:function(){}}}).service("stateService",function(){var currentOwner,currentRepository,currentUser,issues_statuses,currentPage;return currentRepository=void 0,currentOwner=void 0,currentUser=void 0,currentPage=void 0,issues_statuses=void 0,{getCurrentRepository:function(){return currentRepository},setCurrentRepository:function(id){return currentRepository=id},getCurrentOwner:function(){return currentOwner},setCurrentOwner:function(id){return currentOwner=id},getCurrentUser:function(){return currentUser},setCurrentUser:function(user){return currentUser=user},getIssuesStatuses:function(){return issues_statuses},setIssuesStatuses:function(statuses){return issues_statuses=statuses},setActivePage:function(page){return currentPage=page},setFromRoute:function(routeInfo){this.setCurrentRepository(routeInfo.repository_id),this.setCurrentOwner(routeInfo.owner_id)},repositoryUrl:function(){return"#/owners/"+this.getCurrentOwner()+"/repositories/"+this.getCurrentRepository()}}}),gitBoard.factory("milestoneHelper",["Restangular",function(){return{progressBarType:function(milestone){var a=moment(milestone.due_on),b=moment(milestone.created_at),c=moment(),totalDays=a.diff(b,"days"),daysLeft=a.diff(c,"days"),durationPercent=(totalDays-daysLeft)/totalDays,completedPercent=milestone.closed_issues/(milestone.closed_issues+milestone.open_issues);return moment().isAfter(milestone.due_on)?"danger":durationPercent>completedPercent?"warning":"success"}}}]),gitBoard.factory("toastHelper",function(toastr){return{showSuccess:function(message,position){return void 0===position&&(position="toast-top-right"),toastr.success(message,"",{positionClass:position})},showError:function(message,position){return void 0===position&&(position="toast-top-right"),toastr.error(message,"",{positionClass:position})},showErrorsFromValidation:function(errors,position){var arr,i,key,message;void 0===position&&(position="toast-top-right"),message="";for(key in errors){arr=errors[key];
for(i in arr)message=message+key+" "+arr[i]+" <br />"}return toastr.error(message,"",{extendedTimeOut:0,timeOut:0,positionClass:position})}}}),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};this.WebSocketRails=function(){function WebSocketRails(url,use_websockets){this.url=url,this.use_websockets=null!=use_websockets?use_websockets:!0,this.connection_stale=__bind(this.connection_stale,this),this.pong=__bind(this.pong,this),this.supports_websockets=__bind(this.supports_websockets,this),this.dispatch_channel=__bind(this.dispatch_channel,this),this.unsubscribe=__bind(this.unsubscribe,this),this.subscribe_private=__bind(this.subscribe_private,this),this.subscribe=__bind(this.subscribe,this),this.dispatch=__bind(this.dispatch,this),this.trigger_event=__bind(this.trigger_event,this),this.trigger=__bind(this.trigger,this),this.bind=__bind(this.bind,this),this.connection_established=__bind(this.connection_established,this),this.new_message=__bind(this.new_message,this),this.reconnect=__bind(this.reconnect,this),this.callbacks={},this.channels={},this.queue={},this.connect()}return WebSocketRails.prototype.connect=function(){return this.state="connecting",this._conn=this.supports_websockets()&&this.use_websockets?new WebSocketRails.WebSocketConnection(this.url,this):new WebSocketRails.HttpConnection(this.url,this),this._conn.new_message=this.new_message},WebSocketRails.prototype.disconnect=function(){return this._conn&&(this._conn.close(),delete this._conn._conn,delete this._conn),this.state="disconnected"},WebSocketRails.prototype.reconnect=function(){var event,id,old_connection_id,_ref,_ref1;old_connection_id=null!=(_ref=this._conn)?_ref.connection_id:void 0,this.disconnect(),this.connect(),_ref1=this.queue;for(id in _ref1)event=_ref1[id],event.connection_id!==old_connection_id||event.is_result()||this.trigger_event(event);return this.reconnect_channels()},WebSocketRails.prototype.new_message=function(data){var event,socket_message,_i,_len,_ref,_results;for(_results=[],_i=0,_len=data.length;_len>_i;_i++)socket_message=data[_i],event=new WebSocketRails.Event(socket_message),event.is_result()?(null!=(_ref=this.queue[event.id])&&_ref.run_callbacks(event.success,event.data),delete this.queue[event.id]):event.is_channel()?this.dispatch_channel(event):event.is_ping()?this.pong():this.dispatch(event),_results.push("connecting"===this.state&&"client_connected"===event.name?this.connection_established(event.data):void 0);return _results},WebSocketRails.prototype.connection_established=function(data){return this.state="connected",this._conn.setConnectionId(data.connection_id),this._conn.flush_queue(),null!=this.on_open?this.on_open(data):void 0},WebSocketRails.prototype.bind=function(event_name,callback){var _base;return null==(_base=this.callbacks)[event_name]&&(_base[event_name]=[]),this.callbacks[event_name].push(callback)},WebSocketRails.prototype.trigger=function(event_name,data,success_callback,failure_callback){var event,_ref;return event=new WebSocketRails.Event([event_name,data,null!=(_ref=this._conn)?_ref.connection_id:void 0],success_callback,failure_callback),this.trigger_event(event)},WebSocketRails.prototype.trigger_event=function(event){var _base,_name;return null==(_base=this.queue)[_name=event.id]&&(_base[_name]=event),this._conn&&this._conn.trigger(event),event},WebSocketRails.prototype.dispatch=function(event){var callback,_i,_len,_ref,_results;if(null!=this.callbacks[event.name]){for(_ref=this.callbacks[event.name],_results=[],_i=0,_len=_ref.length;_len>_i;_i++)callback=_ref[_i],_results.push(callback(event.data));return _results}},WebSocketRails.prototype.subscribe=function(channel_name,success_callback,failure_callback){var channel;return null==this.channels[channel_name]?(channel=new WebSocketRails.Channel(channel_name,this,!1,success_callback,failure_callback),this.channels[channel_name]=channel,channel):this.channels[channel_name]},WebSocketRails.prototype.subscribe_private=function(channel_name,success_callback,failure_callback){var channel;return null==this.channels[channel_name]?(channel=new WebSocketRails.Channel(channel_name,this,!0,success_callback,failure_callback),this.channels[channel_name]=channel,channel):this.channels[channel_name]},WebSocketRails.prototype.unsubscribe=function(channel_name){return null!=this.channels[channel_name]?(this.channels[channel_name].destroy(),delete this.channels[channel_name]):void 0},WebSocketRails.prototype.dispatch_channel=function(event){return null!=this.channels[event.channel]?this.channels[event.channel].dispatch(event.name,event.data):void 0},WebSocketRails.prototype.supports_websockets=function(){return"function"==typeof WebSocket||"object"==typeof WebSocket},WebSocketRails.prototype.pong=function(){var pong,_ref;return pong=new WebSocketRails.Event(["websocket_rails.pong",{},null!=(_ref=this._conn)?_ref.connection_id:void 0]),this._conn.trigger(pong)},WebSocketRails.prototype.connection_stale=function(){return"connected"!==this.state},WebSocketRails.prototype.reconnect_channels=function(){var callbacks,channel,name,_ref,_results;_ref=this.channels,_results=[];for(name in _ref)channel=_ref[name],callbacks=channel._callbacks,channel.destroy(),delete this.channels[name],channel=channel.is_private?this.subscribe_private(name):this.subscribe(name),channel._callbacks=callbacks,_results.push(channel);return _results},WebSocketRails}()}.call(this),function(){WebSocketRails.Event=function(){function Event(data,success_callback,failure_callback){var attr;this.success_callback=success_callback,this.failure_callback=failure_callback,this.name=data[0],attr=data[1],null!=attr&&(this.id=null!=attr.id?attr.id:65536*(1+Math.random())|0,this.channel=null!=attr.channel?attr.channel:void 0,this.data=null!=attr.data?attr.data:attr,this.token=null!=attr.token?attr.token:void 0,this.connection_id=data[2],null!=attr.success&&(this.result=!0,this.success=attr.success))}return Event.prototype.is_channel=function(){return null!=this.channel},Event.prototype.is_result=function(){return"undefined"!=typeof this.result},Event.prototype.is_ping=function(){return"websocket_rails.ping"===this.name},Event.prototype.serialize=function(){return JSON.stringify([this.name,this.attributes()])},Event.prototype.attributes=function(){return{id:this.id,channel:this.channel,data:this.data,token:this.token}},Event.prototype.run_callbacks=function(success,result){return this.success=success,this.result=result,this.success===!0?"function"==typeof this.success_callback?this.success_callback(this.result):void 0:"function"==typeof this.failure_callback?this.failure_callback(this.result):void 0},Event}()}.call(this),function(){WebSocketRails.AbstractConnection=function(){function AbstractConnection(url,dispatcher){this.dispatcher=dispatcher,this.message_queue=[]}return AbstractConnection.prototype.close=function(){},AbstractConnection.prototype.trigger=function(event){return"connected"!==this.dispatcher.state?this.message_queue.push(event):this.send_event(event)},AbstractConnection.prototype.send_event=function(event){return null!=this.connection_id?event.connection_id=this.connection_id:void 0},AbstractConnection.prototype.on_close=function(event){var close_event;return this.dispatcher&&this.dispatcher._conn===this?(close_event=new WebSocketRails.Event(["connection_closed",event]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(close_event)):void 0},AbstractConnection.prototype.on_error=function(event){var error_event;return this.dispatcher&&this.dispatcher._conn===this?(error_event=new WebSocketRails.Event(["connection_error",event]),this.dispatcher.state="disconnected",this.dispatcher.dispatch(error_event)):void 0},AbstractConnection.prototype.on_message=function(event_data){return this.dispatcher&&this.dispatcher._conn===this?this.dispatcher.new_message(event_data):void 0},AbstractConnection.prototype.setConnectionId=function(connection_id){this.connection_id=connection_id},AbstractConnection.prototype.flush_queue=function(){var event,_i,_len,_ref;for(_ref=this.message_queue,_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],this.trigger(event);return this.message_queue=[]},AbstractConnection}()}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};WebSocketRails.HttpConnection=function(_super){function HttpConnection(url,dispatcher){var e;this.dispatcher=dispatcher,HttpConnection.__super__.constructor.apply(this,arguments),this._url="http://"+url,this._conn=this._createXMLHttpObject(),this.last_pos=0;try{this._conn.onreadystatechange=function(_this){return function(){return _this._parse_stream()}}(this),this._conn.addEventListener("load",this.on_close,!1)}catch(_error){e=_error,this._conn.onprogress=function(_this){return function(){return _this._parse_stream()}}(this),this._conn.onload=this.on_close,this._conn.readyState=3}this._conn.open("GET",this._url,!0),this._conn.send()}return __extends(HttpConnection,_super),HttpConnection.prototype.connection_type="http",HttpConnection.prototype._httpFactories=function(){return[function(){return new XDomainRequest},function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}]},HttpConnection.prototype.close=function(){return this._conn.abort()},HttpConnection.prototype.send_event=function(event){return HttpConnection.__super__.send_event.apply(this,arguments),this._post_data(event.serialize())},HttpConnection.prototype._post_data=function(payload){return $.ajax(this._url,{type:"POST",data:{client_id:this.connection_id,data:payload},success:function(){}})},HttpConnection.prototype._createXMLHttpObject=function(){var e,factories,factory,xmlhttp,_i,_len;for(xmlhttp=!1,factories=this._httpFactories(),_i=0,_len=factories.length;_len>_i;_i++){factory=factories[_i];try{xmlhttp=factory()}catch(_error){e=_error;continue}break}return xmlhttp},HttpConnection.prototype._parse_stream=function(){var data,e,event_data;if(3===this._conn.readyState){data=this._conn.responseText.substring(this.last_pos),this.last_pos=this._conn.responseText.length,data=data.replace(/\]\]\[\[/g,"],[");try{return event_data=JSON.parse(data),this.on_message(event_data)}catch(_error){e=_error}}},HttpConnection}(WebSocketRails.AbstractConnection)}.call(this),function(){var __hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};WebSocketRails.WebSocketConnection=function(_super){function WebSocketConnection(url,dispatcher){this.url=url,this.dispatcher=dispatcher,WebSocketConnection.__super__.constructor.apply(this,arguments),this.url.match(/^wss?:\/\//)?console.log("WARNING: Using connection urls with protocol specified is depricated"):this.url="https:"===window.location.protocol?"wss://"+this.url:"ws://"+this.url,this._conn=new WebSocket(this.url),this._conn.onmessage=function(_this){return function(event){var event_data;return event_data=JSON.parse(event.data),_this.on_message(event_data)}}(this),this._conn.onclose=function(_this){return function(event){return _this.on_close(event)}}(this),this._conn.onerror=function(_this){return function(event){return _this.on_error(event)}}(this)}return __extends(WebSocketConnection,_super),WebSocketConnection.prototype.connection_type="websocket",WebSocketConnection.prototype.close=function(){return this._conn.close()},WebSocketConnection.prototype.send_event=function(event){return WebSocketConnection.__super__.send_event.apply(this,arguments),this._conn.send(event.serialize())},WebSocketConnection}(WebSocketRails.AbstractConnection)}.call(this),function(){var __bind=function(fn,me){return function(){return fn.apply(me,arguments)}};WebSocketRails.Channel=function(){function Channel(name,_dispatcher,is_private,on_success,on_failure){var event,event_name,_ref;this.name=name,this._dispatcher=_dispatcher,this.is_private=null!=is_private?is_private:!1,this.on_success=on_success,this.on_failure=on_failure,this._failure_launcher=__bind(this._failure_launcher,this),this._success_launcher=__bind(this._success_launcher,this),this._callbacks={},this._token=void 0,this._queue=[],event_name=this.is_private?"websocket_rails.subscribe_private":"websocket_rails.subscribe",this.connection_id=null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0,event=new WebSocketRails.Event([event_name,{data:{channel:this.name}},this.connection_id],this._success_launcher,this._failure_launcher),this._dispatcher.trigger_event(event)}return Channel.prototype.destroy=function(){var event,event_name,_ref;return this.connection_id===(null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0)&&(event_name="websocket_rails.unsubscribe",event=new WebSocketRails.Event([event_name,{data:{channel:this.name}},this.connection_id]),this._dispatcher.trigger_event(event)),this._callbacks={}},Channel.prototype.bind=function(event_name,callback){var _base;return null==(_base=this._callbacks)[event_name]&&(_base[event_name]=[]),this._callbacks[event_name].push(callback)},Channel.prototype.trigger=function(event_name,message){var event;return event=new WebSocketRails.Event([event_name,{channel:this.name,data:message,token:this._token},this.connection_id]),this._token?this._dispatcher.trigger_event(event):this._queue.push(event)},Channel.prototype.dispatch=function(event_name,message){var callback,_i,_len,_ref,_ref1,_results;if("websocket_rails.channel_token"===event_name)return this.connection_id=null!=(_ref=this._dispatcher._conn)?_ref.connection_id:void 0,this._token=message.token,this.flush_queue();if(null!=this._callbacks[event_name]){for(_ref1=this._callbacks[event_name],_results=[],_i=0,_len=_ref1.length;_len>_i;_i++)callback=_ref1[_i],_results.push(callback(message));return _results}},Channel.prototype._success_launcher=function(data){return null!=this.on_success?this.on_success(data):void 0},Channel.prototype._failure_launcher=function(data){return null!=this.on_failure?this.on_failure(data):void 0},Channel.prototype.flush_queue=function(){var event,_i,_len,_ref;for(_ref=this._queue,_i=0,_len=_ref.length;_len>_i;_i++)event=_ref[_i],this._dispatcher.trigger_event(event);return this._queue=[]},Channel}()}.call(this);